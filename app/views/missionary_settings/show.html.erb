<% content_for :title, "Privacy & Account Settings" %>

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center space-x-4 mb-4">
      <%= link_to dashboard_missionary_path, class: "text-blue-600 hover:text-blue-800" do %>
        <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Back to Dashboard
      <% end %>
    </div>
    
    <h1 class="text-3xl font-bold text-gray-900">Privacy & Account Settings</h1>
    <p class="text-gray-600">Manage your privacy settings and profile information</p>
  </div>

  <!-- Settings Form -->
  <div class="bg-white shadow-sm rounded-lg border border-gray-200">
    <div class="px-6 py-8">
      <%= form_with model: @missionary_profile, url: missionary_settings_path, method: :patch, local: true, class: "space-y-8" do |form| %>
        <!-- Error Messages -->
        <% if @missionary_profile.errors.any? %>
          <div class="bg-red-50 border border-red-200 rounded-md p-4">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-red-800">
                  There <%= @missionary_profile.errors.count == 1 ? 'was' : 'were' %> 
                  <%= pluralize(@missionary_profile.errors.count, 'error') %> with your submission:
                </h3>
                <div class="mt-2 text-sm text-red-700">
                  <ul class="list-disc list-inside space-y-1">
                    <% @missionary_profile.errors.full_messages.each do |message| %>
                      <li><%= message %></li>
                    <% end %>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Privacy Settings Section -->
        <div class="border-b border-gray-200 pb-8">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Privacy Settings</h2>
          <p class="text-sm text-gray-600 mb-6">
            Choose who can see your profile, updates, and prayer requests. These settings are especially important for missionaries in sensitive locations.
          </p>

          <div>
            <%= form.label :safety_mode, "Privacy Level", class: "block text-sm font-medium text-gray-700 mb-4" %>
            
            <!-- Public Mode -->
            <div class="space-y-4">
              <label class="relative flex items-start p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                <%= form.radio_button :safety_mode, 'public_mode', class: "h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500" %>
                <div class="ml-3 flex-1">
                  <div class="flex items-center">
                    <span class="text-sm font-medium text-gray-900">Public</span>
                    <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                      Maximum Visibility
                    </span>
                  </div>
                  <p class="text-sm text-gray-500 mt-1">
                    Your profile, updates, and prayer requests are visible to everyone on the platform and can appear in public listings.
                    Best for missionaries in open countries who want maximum support and prayer coverage.
                  </p>
                </div>
              </label>

              <!-- Limited Mode -->
              <label class="relative flex items-start p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                <%= form.radio_button :safety_mode, 'limited_mode', class: "h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500" %>
                <div class="ml-3 flex-1">
                  <div class="flex items-center">
                    <span class="text-sm font-medium text-gray-900">Limited</span>
                    <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                      Supporters Only
                    </span>
                  </div>
                  <p class="text-sm text-gray-500 mt-1">
                    Only logged-in users who follow you can see your updates and prayer requests. Your profile is still discoverable but content is restricted.
                    Good for missionaries who want some privacy but still want supporter engagement.
                  </p>
                </div>
              </label>

              <!-- Private Mode -->
              <label class="relative flex items-start p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                <%= form.radio_button :safety_mode, 'private_mode', class: "h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500" %>
                <div class="ml-3 flex-1">
                  <div class="flex items-center">
                    <span class="text-sm font-medium text-gray-900">Private</span>
                    <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
                      Maximum Privacy
                    </span>
                  </div>
                  <p class="text-sm text-gray-500 mt-1">
                    Your profile and content are hidden from public view. Only you and platform administrators can see your information.
                    Essential for missionaries in closed countries or sensitive security situations.
                  </p>
                </div>
              </label>
            </div>
          </div>
        </div>

        <!-- Profile Information Section -->
        <div class="border-b border-gray-200 pb-8">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Profile Information</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Ministry Focus -->
            <div>
              <%= form.label :ministry_focus, class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :ministry_focus, 
                  class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
              <p class="mt-1 text-sm text-gray-500">
                What type of ministry work do you focus on?
              </p>
            </div>

            <!-- Country -->
            <div>
              <%= form.label :country, class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :country, 
                  class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
              <p class="mt-1 text-sm text-gray-500">
                What country are you serving in?
              </p>
            </div>
          </div>

          <!-- Bio -->
          <div class="mt-6">
            <%= form.label :bio, class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_area :bio, 
                rows: 4,
                class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
            <p class="mt-1 text-sm text-gray-500">
              Tell supporters about yourself and your ministry (max 2000 characters)
            </p>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="flex items-center justify-between pt-6">
          <div class="flex items-center space-x-4">
            <%= link_to "Cancel", dashboard_missionary_path, 
                       class: "px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
          </div>
          
          <div class="flex items-center space-x-4">
            <%= form.submit "Save Settings", 
                           class: "px-6 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Security Notice -->
  <div class="mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
    <div class="flex">
      <div class="flex-shrink-0">
        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
      </div>
      <div class="ml-3">
        <p class="text-sm text-yellow-800">
          <strong>Security Reminder:</strong> If you're serving in a sensitive location or closed country, 
          we strongly recommend using Private mode to protect your identity and ministry. Your safety is our priority.
          You can always change these settings later as your situation changes.
        </p>
      </div>
    </div>
  </div>
</div>
